---
- name: Enable Touch ID for sudo
  ansible.builtin.copy:
    src: "{{ role_path }}/files/sudo_local"
    dest: "/etc/pam.d/sudo_local"
    owner: root
    group: wheel
    mode: "0644"
  become: true

- name: Clean up some directories
  ansible.builtin.shell: |
    rm -rfv "{{ item }}" &>/dev/null
  changed_when: false
  become: true
  loop:
    # 'Empty the Trash on all mounted volumes and the main HDD...'
    - "/Volumes/*/.Trashes/*"
    - "{{ ansible_env.HOME }}/.Trash/*"
    # 'Clear System Log Files...'
    - "/private/var/log/asl/*.asl"
    - "/Library/Logs/DiagnosticReports/*"
    - "/Library/Logs/Adobe/*"
    - "{{ ansible_env.HOME }}/Library/Containers/com.apple.mail/Data/Library/Logs/Mail/*"
    - "{{ ansible_env.HOME }}/Library/Logs/CoreSimulator/*"
    # 'Clear Spotify Cache Files...'
    - "{{ ansible_env.HOME }}/Library/Application Support/Spotify/PersistentCache/Update/*.tbz"
    - "{{ ansible_env.HOME }}/Library/Caches/com.spotify.client/Data"
    # 'Clear Adobe Cache Files...'
    - "{{ ansible_env.HOME }}/Library/Application Support/Adobe/Common/Media Cache Files/*"
    # 'Cleanup iOS Applications...'
    - "{{ ansible_env.HOME }}/Music/iTunes/iTunes Media/Mobile Applications/*"
    # 'Remove iOS Device Backups...'
    - "{{ ansible_env.HOME }}/Library/Application Support/MobileSync/Backup/*"
    # 'Cleanup XCode Derived Data and Archives...'
    - "{{ ansible_env.HOME }}/Library/Developer/Xcode/DerivedData/*"
    - "{{ ansible_env.HOME }}/Library/Developer/Xcode/Archives/*"

- name: Clean up Homebrew cache
  ansible.builtin.shell: |
    brew cleanup -s &>/dev/null
    rm -rfv "$(brew --cache)" &>/dev/null
  changed_when: false
  become: true

# TODO: Figure out how to delete ".DS_Store" files
# - name: Find ".DS_Store" files
#   ansible.builtin.find:
#     path: /
#     recurse: true
#     file_type: file
#     patterns:
#       - ".DS_Store"
#   register: ds_store_files

# - name: Delete ".DS_Store" files
#   ansible.builtin.file:
#     path: "{{ item.path }}"
#     state: absent
#   loop: "{{ ds_store_files.files }}"
#   become: true
#   changed_when: false
